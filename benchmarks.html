<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Benchmarks - TicTacToe</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;margin:0;padding:2rem;background:#f5f7fa;color:#1a202c;}
    .container{max-width:1200px;margin:0 auto;}
    h1{margin:0 0 1rem 0;font-size:2rem;color:#2d3748;}
    a{color:#3182ce;text-decoration:none;}
    a:hover{text-decoration:underline;}
    .card{background:white;border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .card h2{margin:0 0 1rem 0;font-size:1.25rem;color:#2d3748;border-bottom:2px solid #e2e8f0;padding-bottom:0.5rem;}
    table{border-collapse:collapse;width:100%;margin-top:1rem;}
    th,td{border:1px solid #e2e8f0;padding:0.75rem;text-align:left;}
    th{background:#f7fafc;font-weight:600;color:#2d3748;}
    tr:hover{background:#f7fafc;}
    .metric-highlight{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:1rem;border-radius:8px;display:inline-block;margin:0.5rem;min-width:200px;text-align:center;}
    .metric-highlight .label{font-size:0.875rem;opacity:0.9;margin-bottom:0.25rem;}
    .metric-highlight .value{font-size:1.75rem;font-weight:bold;}
    .summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-bottom:1.5rem;}
    .info{background:#ebf8ff;border-left:4px solid #3182ce;padding:1rem;border-radius:4px;font-size:0.875rem;color:#2c5282;margin:1rem 0;}
    code{background:#f7fafc;padding:0.2rem 0.4rem;border-radius:4px;font-family:'Courier New',monospace;font-size:0.9em;}
  </style>
</head>
<body>
  <div class="container">
    <h1>⚡ Performance Benchmarks</h1>
    <p><a href="index.html">← Back to Dashboard</a></p>
    
    <div class="card">
      <h2>Latest Results</h2>
      <div id="latest-summary" class="summary-grid"></div>
      <div id="latest-details"></div>
    </div>

    <div class="card">
      <h2>Benchmark History</h2>
      <div id="benchmarks">Loading benchmarks...</div>
    </div>

    <div class="info">
      <strong>About Performance Benchmarks:</strong> Using BenchmarkDotNet to measure AI move calculation performance. Lower microseconds (μs) = faster execution.
    </div>
  </div>

  <script>
    // Fetch and parse the latest markdown report
    fetch('benchmarks/benchmark-latest.md')
      .then(r => r.text())
      .then(md => {
        // Extract table data from markdown
        const lines = md.split('\\n');
        const tableStart = lines.findIndex(l => l.includes('| Method'));
        
        if (tableStart === -1) {
          document.getElementById('latest-summary').innerHTML = '<p>No benchmark results available yet.</p>';
          return;
        }

        // Parse the markdown table
        const dataLines = lines.slice(tableStart + 2).filter(l => l.trim().startsWith('|') && !l.includes('---'));
        const results = dataLines.map(line => {
          const cols = line.split('|').map(c => c.trim()).filter(c => c);
          return {
            method: cols[0],
            mean: cols[1],
            error: cols[2],
            stdDev: cols[3],
            gen0: cols[4] || 'N/A',
            allocated: cols[5] || 'N/A'
          };
        });

        // Display summary cards
        let summaryHTML = '';
        results.forEach(r => {
          summaryHTML += `
            <div class="metric-highlight">
              <div class="label">${r.method}</div>
              <div class="value">${r.mean}</div>
              <div class="label" style="opacity:0.7;font-size:0.75rem;">±${r.error}</div>
            </div>
          `;
        });
        document.getElementById('latest-summary').innerHTML = summaryHTML;

        // Display detailed table
        let tableHTML = '<table><thead><tr><th>Method</th><th>Mean</th><th>Error</th><th>StdDev</th><th>Gen0</th><th>Allocated</th></tr></thead><tbody>';
        results.forEach(r => {
          tableHTML += `<tr><td><code>${r.method}</code></td><td>${r.mean}</td><td>${r.error}</td><td>${r.stdDev}</td><td>${r.gen0}</td><td>${r.allocated}</td></tr>`;
        });
        tableHTML += '</tbody></table>';
        document.getElementById('latest-details').innerHTML = tableHTML;
      })
      .catch(e => {
        document.getElementById('latest-summary').innerHTML = '<p>Benchmark results will appear after first run.</p>';
      });

    // Fetch benchmark history
    fetch('benchmarks/benchmarks-history.json')
      .then(r => r.json())
      .then(data => {
        if (data.length === 0) {
          document.getElementById('benchmarks').textContent = 'No benchmark history yet. Benchmarks run nightly at 02:00 UTC.';
          return;
        }
        let html = '<table><thead><tr><th>Timestamp (UTC)</th><th>Commit</th><th>Results</th></tr></thead><tbody>';
        data.forEach(b => {
          const date = new Date(b.timestampUtc).toLocaleString();
          html += `<tr><td>${date}</td><td><code>${b.commit.substr(0,7)}</code></td><td>${b.results}</td></tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('benchmarks').innerHTML = html;
      })
      .catch(e => { 
        document.getElementById('benchmarks').textContent = 'Benchmark history unavailable. Run triggered on push to main and nightly.'; 
      });
  </script>
</body>
</html>
